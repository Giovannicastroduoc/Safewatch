<ion-header [translucent]="true">
  <ion-toolbar class="header-toolbar">
    <div class="toolbar-container">
      <!-- boton iz-->
      <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" class="custom-back-button"></ion-back-button>
    </ion-buttons>
      
      
      <div class="header-content">
        <ion-icon name="alert-circle" class="header-logo"></ion-icon>
        <div class="header-text">
          <h1 class="header-title">Incidentes</h1>
          <p class="header-subtitle">Reportar y Gestionar</p>
        </div>
      </div>
      
      <div class="header-info">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>{{ incidentes.length }} reportes</span>
        </div>
        
        <ion-button 
          (click)="cargarIncidentes()" 
          class="header-button"
          [class.refreshing]="isLoading">
          <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
        </ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="incidentes-content" [fullscreen]="true">
  <!--fondo grad -->
  <div class="background-wrapper">
    <div class="background-pattern"></div>
    <div class="background-overlay"></div>
  </div>

  <!--content princ-->
  <div class="incidentes-main">
    <!-- tarj p -->
    <div class="main-card">
      <!--form -->
      <div class="form-section">
        <div class="form-header">
          <div class="form-icon-container">
            <div class="form-main-icon">
              <ion-icon name="warning"></ion-icon>
            </div>
            <div class="form-icon-badge">
              <ion-icon name="add" class="badge-icon"></ion-icon>
            </div>
          </div>
          <div class="form-title-section">
            <h2 class="form-title">Nuevo Reporte</h2>
            <p class="form-subtitle">
              <ion-icon name="information-circle" class="subtitle-icon"></ion-icon>
              Complete todos los detalles del incidente observado
            </p>
          </div>
        </div>

        <!--tip incidente-->
        <div class="form-group">
          <div class="input-header">
            <ion-icon name="pricetag" class="input-header-icon"></ion-icon>
            <span class="input-label">Tipo de Incidente</span>
          </div>
          <div class="input-wrapper">
            <ion-icon name="pricetag-outline" class="input-icon"></ion-icon>
            <ion-item class="custom-input-item">
              <ion-input 
                [(ngModel)]="tipo" 
                placeholder="Ej: Fuga de agua, Accidente, Intrusión..."
                class="custom-input"
                [class.has-value]="tipo"
                clearInput>
              </ion-input>
            </ion-item>
            <div class="input-line" [class.active]="tipo"></div>
          </div>
          <div class="input-hint">
            <ion-icon name="help-circle"></ion-icon>
            <span>Describa brevemente el tipo de incidente</span>
          </div>
        </div>

        <!-- gravedad-->
        <div class="form-group">
          <div class="input-header">
            <ion-icon name="alert" class="input-header-icon"></ion-icon>
            <span class="input-label">Nivel de Gravedad</span>
          </div>
          <div class="severity-selector">
            <div class="severity-options">
              <div 
                class="severity-option baja" 
                [class.active]="gravedad === 'Baja'"
                (click)="gravedad = 'Baja'">
                <div class="severity-indicator">
                  <div class="severity-dot"></div>
                  <ion-icon name="checkmark" class="check-icon"></ion-icon>
                </div>
                <div class="severity-content">
                  <ion-icon name="alert-circle-outline" class="severity-icon baja"></ion-icon>
                  <div class="severity-info">
                    <span class="severity-level">Baja</span>
                    <span class="severity-desc">Sin urgencia</span>
                  </div>
                </div>
              </div>

              <div 
                class="severity-option media" 
                [class.active]="gravedad === 'Media'"
                (click)="gravedad = 'Media'">
                <div class="severity-indicator">
                  <div class="severity-dot"></div>
                  <ion-icon name="checkmark" class="check-icon"></ion-icon>
                </div>
                <div class="severity-content">
                  <ion-icon name="warning-outline" class="severity-icon media"></ion-icon>
                  <div class="severity-info">
                    <span class="severity-level">Media</span>
                    <span class="severity-desc">Atención requerida</span>
                  </div>
                </div>
              </div>

              <div 
                class="severity-option alta" 
                [class.active]="gravedad === 'Alta'"
                (click)="gravedad = 'Alta'">
                <div class="severity-indicator">
                  <div class="severity-dot"></div>
                  <ion-icon name="checkmark" class="check-icon"></ion-icon>
                </div>
                <div class="severity-content">
                  <ion-icon name="alert-triangle-outline" class="severity-icon alta"></ion-icon>
                  <div class="severity-info">
                    <span class="severity-level">Alta</span>
                    <span class="severity-desc">Urgente</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--desc-->
        <div class="form-group">
          <div class="input-header">
            <ion-icon name="document-text" class="input-header-icon"></ion-icon>
            <span class="input-label">Descripción Detallada</span>
          </div>
          <div class="input-wrapper textarea-wrapper">
            <ion-icon name="document-text-outline" class="input-icon"></ion-icon>
            <ion-item class="custom-input-item textarea-item">
              <ion-textarea 
                [(ngModel)]="descripcion" 
                rows="4"
                placeholder="Describa el incidente con todos los detalles relevantes..."
                class="custom-textarea"
                [class.has-value]="descripcion"
                autoGrow>
              </ion-textarea>
            </ion-item>
            <div class="input-line" [class.active]="descripcion"></div>
          </div>
          <div class="char-counter">
            <ion-icon name="text" class="counter-icon"></ion-icon>
            <span>{{ descripcion.length }}/500 caracteres</span>
          </div>
        </div>

        <!--btn env-->
        <ion-button 
          expand="block" 
          (click)="reportarIncidente()"
          [class.loading]="isLoading"
          class="submit-button">
          <div class="button-content">
            <ion-icon name="document-text-outline" class="button-icon" *ngIf="!isLoading"></ion-icon>
            <ion-spinner *ngIf="isLoading"></ion-spinner>
            <span class="button-text">
              {{ isLoading ? 'Reportando...' : 'Reportar Incidente' }}
            </span>
          </div>
          <div class="button-shine"></div>
          <div class="button-particles"></div>
        </ion-button>

        <!--form ayuda -->
        <div class="form-help">
          <div class="help-item">
            <ion-icon name="shield-checkmark"></ion-icon>
            <span>Información segura</span>
          </div>
          <div class="help-item">
            <ion-icon name="time"></ion-icon>
            <span>Respuesta rápida</span>
          </div>
          <div class="help-item">
            <ion-icon name="notifications"></ion-icon>
            <span>Notificación inmediata</span>
          </div>
          <div class="help-item">
            <ion-icon name="people"></ion-icon>
            <span>Equipo de soporte</span>
          </div>
        </div>
      </div>

      <!--selec incide existente-->
      <div class="incidentes-section" *ngIf="incidentes.length > 0">
        <div class="section-header">
          <h2 class="section-title">
            <ion-icon name="list" class="section-icon"></ion-icon>
            Incidentes Reportados
          </h2>
          <div class="section-badge">
            <ion-icon name="document" class="badge-icon"></ion-icon>
            <span class="badge-count">{{ incidentes.length }}</span>
          </div>
        </div>

        <div class="incidentes-list">
          <div 
            *ngFor="let inc of incidentes; trackBy: trackByIncidenteId" 
            class="incidente-card"
            #incidenteCard>
            
            <div class="incidente-background" [ngClass]="'bg-' + inc.gravedad.toLowerCase()"></div>
            
            <div class="incidente-header">
              <div class="incidente-type">
                <div class="type-icon" [ngClass]="inc.gravedad.toLowerCase()">
                  <ion-icon [name]="getSeverityIcon(inc.gravedad)"></ion-icon>
                </div>
                <div class="type-info">
                  <h3 class="incidente-tipo">{{ inc.tipo }}</h3>
                  <div class="incidente-meta">
                    <div class="meta-item">
                      <ion-icon name="time-outline"></ion-icon>
                      <span>{{ inc.fecha }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="incidente-severity">
                <div class="severity-badge" [ngClass]="inc.gravedad.toLowerCase()">
                  <ion-icon [name]="getSeverityIcon(inc.gravedad)"></ion-icon>
                  <span>{{ inc.gravedad }}</span>
                </div>
              </div>
            </div>

            <div class="incidente-content">
              <div class="description-container">
                <ion-icon name="document-text-outline" class="desc-icon"></ion-icon>
                <p class="incidente-descripcion">{{ inc.descripcion }}</p>
              </div>
            </div>

            <div class="incidente-footer">
              <div class="footer-actions">
                <button class="action-btn">
                  <ion-icon name="eye-outline"></ion-icon>
                  <span>Ver detalles</span>
                </button>
                <button class="action-btn">
                  <ion-icon name="share-outline"></ion-icon>
                  <span>Compartir</span>
                </button>
              </div>
              <div class="footer-status">
                <div class="status-indicator pendiente">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>Pendiente</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--est vacio-->
      <div *ngIf="incidentes.length === 0" class="empty-state">
        <div class="empty-illustration">
          <div class="empty-icon-container">
            <ion-icon name="checkmark-done-circle-outline" class="empty-main-icon"></ion-icon>
            <div class="empty-sparkles">
              <div class="sparkle"></div>
              <div class="sparkle"></div>
              <div class="sparkle"></div>
            </div>
          </div>
          
        </div>
        <h3 class="empty-title">Sin Incidentes Reportados</h3>
        <p class="empty-description">
          <ion-icon name="rocket" class="empty-desc-icon"></ion-icon>
          ¡Excelente trabajo! No hay incidentes pendientes
        </p>
        <div class="empty-actions">
          <button class="empty-action-btn primary" (click)="scrollToForm()">
            <ion-icon name="add-circle"></ion-icon>
            <span>Reportar Primer Incidente</span>
          </button>
          <button class="empty-action-btn secondary" (click)="cargarIncidentes()">
            <ion-icon name="refresh"></ion-icon>
            <span>Actualizar</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</ion-content>

